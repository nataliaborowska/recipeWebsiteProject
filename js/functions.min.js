$(document).ready(function(){function a(){$("html, body").animate({scrollTop:0},500)}function b(a,b){for(var c="",d=0;d<a;d++)c+="<span>â˜…</span>";b.html(c)}function c(c,d,e,f,g,h,i,j,k,l){var m,n;if(c.empty(),a(),e.length>0){e.map(function(a,e){var i=a.rating,j=$(d).filter(f).html(),k=Mustache.render(j,a);c.append(k);var o;if(m=$(g),n=$(h).eq(e),i){o=a.recipeAllData;b(i,$(l).eq(e))}else o=a;B[e]=n,B[e].data("recipe",o)});for(var o=0;o<m.length;o+=i)m.slice(o,o+i).wrapAll(j)}else c.append("<div class='emptyResult'><h3>No results found</h3></div>");c.prepend("<div class='pageTitle'><h2>"+k+"</h2></div>")}function d(c,d){function e(a){var d=$(".reviewsTitle"),e=(new Date).getTime();localStorage.getItem("opinion")&&(a.empty(),v=JSON.parse(localStorage.getItem("opinion")).filter(function(a){return a.recipeAllData.name==f.name}),0!==v.length&&(v.map(function(d,f){d.daysAgo=Math.round(Math.abs(e-d.opinionDate)/864e5),d.daysAgo>0?d.daysAgo+="days ago":0===d.daysAgo?d.daysAgo="today":d.daysAgo+="day ago";var g=$(c).filter("#reviewTemplate").html(),h=Mustache.render(g,d);a.append(h);var i=$(".starContainer").eq(f);b(d.rating,i)}),0===d.length&&s.prepend("<h3 class='reviewsTitle'>Reviews</h3>"))),p.attr("checked",!1),p.on("click",function(){q.removeClass("checked"),$(this).parent().addClass("checked")})}var f=$(this).data().recipe;h.empty(),a();var g=$(c).filter(d).html(),i=Mustache.render(g,f);h.append(i);var j=$("#opinionForm"),k=$(":input").not(":input[type=submit], :input[type=radio]"),l=$(".mandatoryText"),m=$("#formResponse"),n=$("#email"),o=$("#userName"),p=$(".rating input[type='radio']"),q=$(".rating span"),r=$(".errorComment"),s=$(".detailsContainer__reviews"),t=$(".reviewsContainer"),u=[],v=[];return e(t),j.on("submit",function(a){a.preventDefault();var b,c=0,d=$(this).closest(".detailsContainer").find(".reviewsContainer");if(r.text(""),m.empty(),l.each(function(a,d){b=$(d),(""===b.val()||b.val().length<1)&&(b.closest("li").find(".errorComment").text("please fill in the "+b.attr("id")+" field"),c++)}),p.is(":checked")||(p.closest("li").find(".errorComment").text("please choose the rating"),c++),o.val().length>0&&o.val().length<3&&(o.prev().text("name must contain at least 3 characters"),c++),n.val().length>0&&-1==n.val().search(/^([a-z0-9_\.-]+)@([a-z0-9_\.-]+)\.([a-z\.]{2,6})$/)&&(n.prev().text("please fill in the email field correctly"),c++),0===c){var g=(new Date).getTime(),h=$.param({opinionDate:g,recipeAllData:f}),i=j.serialize()+"&"+h;$.ajax({type:"POST",data:i,url:"php/verifyForm.php",cache:!1,success:function(a){var b,c=$.parseJSON(a),f=new RegExp("Error");if($.each(c,function(a,c){-1!=a.search(f)?($("#"+a).text(c),b=!0):(k.each(function(){$(this).val(""),q.removeClass("checked")}),p.each(function(){$(this).prop("checked",!1)}),b=!1)}),!1===b){if(m.fadeIn(2e3).html("<p>Thank you for giving your opinion!</p>").fadeOut(3e3),null!==localStorage.getItem("opinion")){var g=localStorage.getItem("opinion");u=JSON.parse(g),u.push(c),localStorage.setItem("opinion",JSON.stringify(u))}else u.push(c),localStorage.setItem("opinion",JSON.stringify(u));e(d)}},error:function(a,b,c){m.html("<p>The form was filled correctly, but there was an error on the server. Please try again.</p>")}})}}),!1}function e(a){var b=$(this);return $.ajax({type:"GET",url:"recipes.json",dataType:"JSON",cache:!1,success:function(e){var f=[];if("click"==a.type){var g=b.attr("href");n.removeClass("activeLink"),"navLink"==b.attr("class")?b.toggleClass("activeLink"):"linkBack"==b.attr("class")&&$("a[href='"+g+"']").toggleClass("activeLink"),h=k,f=e.recipes.filter(function(a){return g==a.type}),$.each(f,function(a,b){i=b.type})}else if("submit"==a.type){var j=t.val(),l=new RegExp(j,"i");a.preventDefault(),h=s,j.length>0&&(f=e.recipes.filter(function(a){return-1!=a.name.search(l)||-1!=a.type.search(l)}),i="Search results for "+j)}$.each(f,function(a,b){f[a].shortDescription=f[a].description.substring(0,120)}),$.get("templates/template.html",function(a){c(h,a,f,"#recipeTemplate",".recipeUnit",".buttonDetails",2,"<div class='row recipeRow'></div>",i),B.map(function(b){b.on("click",function(){h=k,d.call(this,a,"#detailsTemplate")})})})},error:function(a,b,c){k.empty();var d=a.status,e=a.statusText;k.append("<div class='error'><h1>"+d+" Error</h1><h2>"+e+"</h2></div>")}}),!1}function f(a){window.location.reload()}function g(){var a=$(this).scrollTop();a<C?(m.removeClass("slideUp").addClass("slideDown"),a<l&&m.removeClass("slideDown")):a>C&&a>l+p&&m.removeClass("slideDown").addClass("slideUp"),C=a,q.removeClass("openIcon"),m.removeClass("openNav")}var h,i,j=$(window),k=$("section"),l=$("header").outerHeight(),m=$("nav"),n=$(".navLink"),o=$(".navList").find(".navLink"),p=m.outerHeight(),q=$(".mobileNav"),r=$("#searchForm"),s=$(".resultField"),t=$("#searchField"),u=$(".highRatingContainer"),v=$(".sliderContainer"),w=$(".categoryList"),x=$(".prev"),y=$(".next"),z=$(".warningPopup"),A=$("#popupConsent"),B=[];a(),function(a){var b="(^|;s?)"+a+"=",c=new RegExp(b);if(document.cookie.match(c))z.css("display","none");else{z.fadeIn("slow");var d=new Date;d.setDate(d.getDate()+2592e6),d.toUTCString(),document.cookie=a+"=yes; expires="+d+";path=/",A.on("click",function(){return z.fadeOut("slow"),!1})}}("popup"),$.when(function(){var a=[];h=u,localStorage.getItem("opinion")&&(h.empty(),a=JSON.parse(localStorage.getItem("opinion")).sort(function(a,b){return b.rating-a.rating}).slice(0,3),$.get("templates/template.html",function(b){c(h,b,a,"#highReviewsTemplate",".reviewUnit",".reviewedRecipeDetails",3,"<div class='highRatingContainer__items row'></div>","Highest reviews",".reviewedRecipeData__starContainer"),B.map(function(a){a.on("click",function(){h=k,d.call(this,b,"#detailsTemplate")})})}))}()).then(function(){var a=[],b={};$.ajax({type:"GET",url:"recipes.json",dataType:"JSON",cache:!1,success:function(c){h=w,a=o.map(function(){return $(this).attr("href")}).toArray(),$.each(a,function(d,e){var f,g=[],h=[];for(g=c.recipes.filter(function(a){return e==a.type});h.length<3;)f=Math.floor(Math.random()*a.length),-1==h.indexOf(g[f])&&h.push(g[f]);b[e]=h}),$.get("templates/template.html",function(a){function c(){$(".active").removeClass("active").addClass("prevActive"),$(".prevActive").is(":first-child")?f.last().addClass("active"):$(".prevActive").prev().addClass("active"),$(".prevActive").fadeOut("slow"),$(".prevActive").removeClass("prevActive"),$(".active").fadeIn("slow")}function d(){$(".active").removeClass("active").addClass("prevActive"),$(".prevActive").is(":last-child")?f.first().addClass("active"):$(".prevActive").next().addClass("active"),$(".prevActive").fadeOut("slow"),$(".prevActive").removeClass("prevActive"),$(".active").fadeIn("slow")}var e=$(a).filter("#galleryTemplate").html();$.each(b,function(a,b){var c=Mustache.render(e,b);h.append(c)}),v.prepend("<h2>Gallery</h2>");var f=$(".categoryList__item");f.first().addClass("active"),f.hide(),$(".active").show(),x.on("click",function(){c()}),y.on("click",function(){d()})})}})}()),$(document).on("click",".navLink, .linkBack",e),r.on("submit",e),$(".homeLogo").on("click",f);var C=0;j.on("scroll",g),q.on("click",function(a){$(this).toggleClass("openIcon"),m.toggleClass("openNav"),a.stopPropagation()}),$("html").on("click",function(){q.hasClass("openIcon")&&(q.removeClass("openIcon"),m.removeClass("openNav"))})});